# Restaurant Depot layout rules
# Multiple layouts that apply based on file extension, header text, or content
rd_layouts:
  # Variant A: Require Item Description + Extended Amount (USD), with qty/unit optional
  - name: "RD Excel v_qty_unit_total"
    parsed_by: "rd_excel_v1"
    applies_to:
      vendor_code: ["RD", "RESTAURANT_DEPOT"]
      file_ext: [".xlsx", ".xls"]
      header_contains:
        - "Item Description"
        - "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?"
    required_columns:
      - "Item Description"
      - "Extended Amount (USD)"
    optional_columns:
      - "QTY"
      - "Unit Price"
      - "Item Number"
      - "UPC"
      - "Transaction Date"
    column_mappings:
      product_name: "Item Description"
      quantity: "^(QTY|Qty|Quantity)$"
      unit_price: "^(Unit\\s*Price|Price|UnitPrice)$"
      total_price: "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?|Total\\s*Price"
      item_number: "^(Item\\s*Number|Item\\s*#|Item\\s*No\\.?|Item#|SKU)$"
      upc: "^(UPC|Barcode)$"
      transaction_date: "^(Transaction\\s*Date|Date|Trans\\s*Date|TransactionDate)$"
    normalization:
      trim_whitespace: true
      preserve_case: true
    skip_patterns:
      # Note: Do NOT add control keywords like "TOTAL", "TAX", "Total Items Sold" here
      # They are handled by CONTROL_PATTERNS in layout_applier.py
      - "BALANCE"
      - "PREVIOUS BALANCE"

  # Variant B: No qty/unit, still extract name + total
  - name: "RD Excel v_total_only"
    parsed_by: "rd_excel_v2"
    applies_to:
      vendor_code: ["RD", "RESTAURANT_DEPOT"]
      file_ext: [".xlsx", ".xls"]
      header_contains:
        - "Item Description"
        - "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?"
    required_columns:
      - "Item Description"
      - "Extended Amount (USD)"
    optional_columns:
      - "Item Number"
      - "UPC"
      - "Transaction Date"
    column_mappings:
      product_name: "Item Description"
      total_price: "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?|Total\\s*Price"
      item_number: "^(Item\\s*Number|Item\\s*#|Item\\s*No\\.?|Item#|SKU)$"
      upc: "^(UPC|Barcode)$"
      transaction_date: "^(Transaction\\s*Date|Date|Trans\\s*Date|TransactionDate)$"
    normalization:
      trim_whitespace: true
      preserve_case: true
    skip_patterns:
      # Note: Do NOT add control keywords like "TOTAL", "TAX", "Total Items Sold" here
      # They are handled by CONTROL_PATTERNS in layout_applier.py
      - "BALANCE"
      - "PREVIOUS BALANCE"

  # CSV variant: make it as tolerant as Excel
  - name: "RD CSV Report (Extended Format)"
    parsed_by: "rd_excel_v2_csv"
    applies_to:
      vendor_code: ["RD", "RESTAURANT_DEPOT"]
      file_ext: [".csv", ".CSV"]
      header_contains:
        - "Item Description"
        - "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?"
    required_columns:
      - "Item Description"
      - "Extended Amount (USD)"
    optional_columns:
      - "QTY"
      - "Unit Price"
      - "UPC"
      - "Item Number"
      - "Transaction Date"
    column_mappings:
      product_name: "Item Description"
      quantity: "^(QTY|Qty|Quantity)$"
      unit_price: "^(Unit\\s*Price|Price|UnitPrice)$"
      total_price: "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?|Total\\s*Price"
      upc: "^(UPC|Barcode)$"
      item_number: "^(Item\\s*Number|Item\\s*#|Item\\s*No\\.?|Item#|SKU)$"
      transaction_date: "^(Transaction\\s*Date|Date|Trans\\s*Date|TransactionDate)$"
    normalization:
      trim_whitespace: true
      preserve_case: true
    skip_patterns:
      # Note: Do NOT add control keywords like "TOTAL", "TAX", "Total Items Sold" here
      # They are handled by CONTROL_PATTERNS in layout_applier.py
      - "BALANCE"
      - "PREVIOUS BALANCE"
      - ""
      - "nan"
  
  # PDF variant: Grid mode (uses pdfplumber to extract tables, then applies same column mappings as Excel)
  - name: "RD PDF Grid v1"
    parsed_by: "rd_pdf_v1"
    applies_to:
      vendor_code: ["RD", "RESTAURANT_DEPOT"]
      file_ext: [".pdf"]
      header_contains:
        - "Item Description"
        - "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?"
      text_contains:
        - "Restaurant Depot"
        - "Item Description"
    required_columns:
      - "Item Description"
      - "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?"
    optional_columns:
      - "QTY"
      - "Unit Price"
      - "Item Number"
      - "UPC"
      - "Transaction Date"
    column_mappings:
      product_name: "Item Description"
      quantity: "^(QTY|Qty|Quantity)$"
      unit_price: "^(Unit\\s*Price|Price|UnitPrice|U\\s*Price)$"
      total_price: "(?i)Extended\\s*Amount(?:\\s*\\(USD\\))?|Total\\s*Price|Amount"
      item_number: "^(Item\\s*Number|Item\\s*#|Item\\s*No\\.?|Item#|SKU)$"
      upc: "^(UPC|Barcode)$"
      transaction_date: "^(Transaction\\s*Date|Date|Trans\\s*Date|TransactionDate)$"
    normalization:
      trim_whitespace: true
      preserve_case: true
    skip_patterns:
      # Note: Do NOT add control keywords like "TOTAL", "TAX", "Total Items Sold" here
      # They are handled by CONTROL_PATTERNS in layout_applier.py
      - "BALANCE"
      - "PREVIOUS BALANCE"
