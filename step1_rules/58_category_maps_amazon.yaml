# Amazon Source Mapping
# Maps Amazon item titles, categories, and seller info to L2 categories

category_maps_amazon:
  description: >
    Ordered rules for classifying Amazon items based on title, category, group, and seller.
    Rules are evaluated in priority order (higher priority wins).
  
  rules:
    # ===== UNSPSC TAXONOMY-BASED (HIGHEST PRIORITY) =====
    # Use Amazon's standardized UNSPSC codes for accurate classification
    
    - match:
        unspsc_family: 'Chocolate and sugars and sweeteners and confectionary products'
      map_to_l2: C33  # Retail Snacks & Beverages (not ingredients)
      priority: 100
      notes: Confectionary products like cookies, candy, chocolate for resale
    
    - match:
        unspsc_family: 'Seasonings and preservatives'
      map_to_l2: C03  # Jam/Purée/Sauce
      priority: 100
      notes: Sauces, seasonings, preserves
    
    - match:
        unspsc_family: 'Prepared and preserved foods'
      map_to_l2: C01  # Tea & Coffee (or C33 depending on product)
      priority: 95
      notes: Prepared foods like nuts, dried fruits - check title for specifics
    
    
    
    - match:
        unspsc_segment: 'Food Beverage and Tobacco Products'
        unspsc_family: 'Dairy products and eggs'
      map_to_l2: C04  # Dairy & Milk
      priority: 100
      notes: Dairy products
    
    # ===== PACKAGING ===== (vendor-agnostic keywords handle these)
    
    # ===== TEA & COFFEE ===== (handled by global keywords)

    # ===== NUTS / INGREDIENTS =====
    - match:
        item_title_regex: '(?i)\b(almond|almonds|sliced almonds|raw almonds|unsalted almonds)\b'
      map_to_l2: C15  # Other Ingredients (nuts)
      priority: 96
      notes: Nuts like almonds are ingredients
    
    # ===== SYRUPS =====
    
    - match:
        item_title_regex: '(?i)\b(syrup|syrups|torani|monin)\b'
      map_to_l2: C02  # Syrups
      priority: 95
      notes: Syrups
    
    # ===== TOPPINGS & JELLIES ===== (handled by global keywords)
    
    # ===== DAIRY ===== (handled by global keywords and UNSPSC dairy products)
    
    # ===== SWEETENERS =====
    
    - match:
        item_title_regex: '(?i)\b(sugar|brown sugar|honey|agave|stevia)\b'
      map_to_l2: C05  # Sweeteners/Sugar
      priority: 90
      notes: Sweeteners
    
    # ===== NON-FOOD CONSUMABLES ===== (handled by global keywords)
    
    # ===== CLEANING ===== (handled by global keywords)
    
    # ===== SMALLWARES & EQUIPMENT =====
    # Specific override: Straw holder should be treated as Non-food Consumables (C31)
    - match:
        item_title_regex: '(?i)\bstraw\s+holder\b'
      map_to_l2: C31  # Gloves & Food Service Supplies (Non-food Consumables)
      priority: 98
      notes: Straw holders are non-food consumables used in service area
    
    # Specific: Sand bags for canopy stabilization → equipment/smallwares
    - match:
        item_title_regex: '(?i)\b(sand\s*bags?)\b.*\b(canopy|canopies|tent)\b'
      map_to_l2: C40  # Smallwares & Equipment
      priority: 97
      notes: Sand bags used to stabilize canopy/tent legs considered equipment

    
    
    # ===== OFFICE =====
    # POS supplies: thermal receipt paper, register tape, POS paper
    # High priority to override generic UNSPSC 'Paper products' → C30 mapping
    - match:
        item_title_regex: '(?i)\b(thermal\s+(receipt\s+)?paper|receipt\s+paper|pos\s+(paper|roll|tape)|register\s+(tape|paper)|receipt\s+rolls?)\b'
      map_to_l2: C61  # POS Paper & Register Supplies
      priority: 150
      notes: POS supplies like MUNBYN thermal receipt paper map to POS Paper (override UNSPSC paper)
    
    # Specific: Barcode/UPC label rolls (Zebra/Rollo compatible) → Labels & Stickers
    - match:
        item_title_regex: '(?i)\\b(label|labels|barcode|upc|zebra|rollo)\\b|(?i)\\b(UPC|barcode)[^\n]{0,80}?labels?\\b'
      map_to_l2: C23
      priority: 120
      notes: Amazon-specific labeling products (barcode/UPC, Zebra/Rollo)

    # Specific: Water filters (e.g., 3M HF20-S) → Filters & Disposables
    - match:
        item_title_regex: '(?i)\\b(water\\s*filter|3M|HF\\d+\\s*-?S)\\b'
      map_to_l2: C32
      priority: 120
      notes: Equipment filters like 3M HF20-S

    # Backup: Retail snacks by brand/keywords (low priority)
    - match:
        item_title_regex: '(?i)\\bFerrero\\s*Rocher\\b|(?i)\\bBiscoff\\b|(?i)\\bcookie(s)?\\b|(?i)\\bchocolate(s)?\\b|(?i)\\bcandy\\b|(?i)\\bsnack(s)?\\b'
      map_to_l2: C33
      priority: 67
      notes: Backup mapping when UNSPSC is missing

    
    
    # ===== FEES (Amazon-specific) =====
    
    - match:
        is_fee: true
        text_contains: ['shipping', 'freight']
      map_to_l2: C80  # Shipping/Delivery
      priority: 100
      notes: Shipping charges
    
    - match:
        is_fee: true
        text_contains: ['tax']
      map_to_l2: C70  # Taxes & Fees
      priority: 100
      notes: Tax fees
    
    - match:
        is_fee: true
        text_contains: ['promotion', 'promo', 'discount']
      map_to_l2: C95  # Discounts/Promos
      priority: 100
      notes: Promotions and discounts
    
    - match:
        is_fee: true
        text_contains: ['handling', 'recycling', 'postal', 'fee']
      map_to_l2: C70  # Taxes & Fees
      priority: 95
      notes: Other fees
    
    
    
    # ===== DEFAULT FALLBACK =====
    
    - match:
        default: true
      map_to_l2: C99  # Unknown
      priority: 0
      notes: Fallback for unmatched items

notes:
  - Rules are evaluated in priority order (highest first)
  - item_title_regex matches against product Title (case-insensitive)
  - text_contains is for fee items (product_name field)
  - category matches against Amazon-Internal Product Category
  - group and seller can be used for additional filtering
  - is_fee=true applies only to fee items (not products)
  - If no rule matches, item falls through to keyword/heuristic matching

