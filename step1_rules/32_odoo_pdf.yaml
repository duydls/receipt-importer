# Generic Odoo Purchase Order (PDF) â€” regex-driven

document_type: "purchase_order"

vendor_name: "Odoo System"
parsed_by: "odoo_po_v1"
extraction_method: "regex"
currency_default: "USD"

# Layout detection (any one match is enough)
layout_detection:
  any:
    - pattern: "(?i)\\bPurchase\\s*Order\\b"
    - pattern: "(?i)\\bDescription\\s+Qty\\s+UoM\\s+Unit\\s*Price\\s+Amount\\b"

# Optional vendor detection (keep generic; adjust as needed)
vendor_detection:
  try:
    - name: "Park To Shop"
      pattern: "(?im)\\bVendor\\s*:?\\s*Park\\s*To\\s*Shop\\b"
    - name: "Mariano's"
      pattern: "(?im)\\bVendor\\s*:?\\s*Mariano'?s\\b"
  fallback:
    - pattern: "(?im)^\\s*Vendor\\s*:?\\s*([A-Za-z0-9'&()\\-\\. ]+?)\\s{2,}"
      group: 1
      field: vendor_name

# Header metadata
metadata_patterns:
  po_number:
    pattern: "(?im)\\bPurchase\\s*Order\\s*#?\\s*:?\\s*([A-Z0-9\\-]+)"
    group: 1
    field: receipt_number
    case_insensitive: true
  
  order_number:
    pattern: "(?im)\\bPurchase\\s*Order\\s*#?\\s*:?\\s*([A-Z0-9\\-]+)"
    group: 1
    field: order_number
    case_insensitive: true
  
  order_date:
    pattern: "(?im)\\bOrder\\s*Date\\s*:?\\s*([0-9]{2}/[0-9]{2}/[0-9]{4})"
    group: 1
    field: transaction_date
    date_format: "%m/%d/%Y"
    case_insensitive: true
  
  expected_arrival:
    pattern: "(?im)\\bExpected\\s*Arrival\\s*:?\\s*([0-9]{2}/[0-9]{2}/[0-9]{4})"
    group: 1
    field: expected_arrival
    date_format: "%m/%d/%Y"
    case_insensitive: true
  
  shipping_address_raw:
    # Capture the freeform block after "Shipping address:" up to the next major header
    pattern: "(?is)\\bShipping\\s*address\\s*:\\s*(.+?)\\n\\s*Purchase\\s*Order\\b"
    group: 1
    field: shipping_address_raw
    case_insensitive: true
  
  # Vendor Information (multiple patterns to catch different formats)
  vendor_name:
    pattern: "(?im)\\bVendor\\s*:?\\s*([A-Za-z0-9'&()\\-\\. ]+?)\\s{2,}"
    group: 1
    field: vendor
    case_insensitive: true
  
  vendor_name_alt1:
    pattern: "(?im)^\\s*Vendor\\s*:?\\s*([A-Za-z][^\\n]{0,50})"
    group: 1
    field: vendor
    case_insensitive: true

# --- Item Extraction Patterns ---
item_patterns:
  # Pattern 1: Description | Qty | UoM | Unit Price | Amount (Odoo format)
  # Example: "Strawberry                     1.0    lb      $ 4.99       $ 4.99"
  - type: "odoo_structured_item"
    regex: "(?im)^\\s*(?P<description>[A-Za-z][A-Za-z0-9 \\-'/&(),.]+?)\\s+(?P<qty>\\d+(?:\\.\\d+)?)\\s+(?P<uom>[A-Za-z]+)\\s+\\$?\\s*(?P<unit_price>\\d{1,3}(?:,\\d{3})*\\.\\d{2})\\s+\\$?\\s*(?P<amount>\\d{1,3}(?:,\\d{3})*\\.\\d{2})\\s*$"
    groups:
      - description
      - qty
      - uom
      - unit_price
      - amount
    description: "Odoo format: Description | Qty | UoM | Unit Price | Amount"
    field_mappings:
      product_name: "description"
      quantity: "qty"
      unit_price: "unit_price"
      total_price: "amount"
    case_insensitive: false
    postprocess:
      - field: uom
        map:
          "Units": "unit"
          "Unit": "unit"
          "LB": "lb"
          "Lb": "lb"
          "lb": "lb"

# --- Skip Keywords (lines to ignore) ---
skip_keywords:
  - "^\\s*Receipt\\s*$"
  - "^\\s*Invoice\\s*$"
  - "^\\s*Order\\s*$"
  - "^\\s*Date\\s*$"
  - "^\\s*Total\\s*$"
  - "^\\s*Subtotal\\s*$"
  - "^\\s*Tax\\s*$"
  - "^\\s*Vendor\\s*$"
  - "^\\s*Store\\s*$"
  - "^\\s*Merchant\\s*$"
  - "^\\s*Customer\\s*$"
  - "^\\s*Bill\\s+To\\s*$"
  - "^\\s*Thank\\s+You\\s*$"
  - "^\\s*Receipt\\s+Number\\s*$"
  - "^\\s*Date\\s+of\\s+Sale\\s*$"
  - "^\\s*Description.*Qty.*UoM.*Unit\\s+Price.*(?:TaxesAmount|Amount)\\s*$"
  - "^\\s*Shipping\\s+address:\\s*$"
  - "^\\s*Purchase\\s+Order\\s*#"
  - "^\\s*Buyer\\s*$"
  - "^\\s*Order\\s+Date:\\s*$"
  - "^\\s*Expected\\s+Arrival:\\s*$"
  - "^\\s*Payment\\s+Terms:\\s*$"
  - "^\\s*Vendor.*Vendor\\s+Ref\\s*$"
  - "^\\s*Email.*Phone\\s*$"

# --- Summary Keywords (stop parsing items when these are found) ---
summary_keywords:
  - "^\\s*Subtotal\\b"
  - "^\\s*Sub\\s+Total\\b"
  - "^\\s*Tax\\b"
  - "^\\s*Sales\\s+Tax\\b"
  - "^\\s*Total\\b"
  - "^\\s*Grand\\s+Total\\b"
  - "^\\s*Amount\\s+Due\\b"
  - "^\\s*Balance\\s+Due\\b"
  - "^\\s*Untaxed\\s+Amount\\b"

# --- Total Extraction Patterns ---
total_patterns:
  untaxed_amount:
    pattern: "(?im)^\\s*Untaxed\\s*Amount\\s*\\$?\\s*(\\d{1,3}(?:,\\d{3})*\\.\\d{2})"
    group: 1
    case_insensitive: true
  
  total:
    pattern: "(?im)^\\s*Total\\s*\\$?\\s*(\\d{1,3}(?:,\\d{3})*\\.\\d{2})"
    group: 1
    case_insensitive: true
  
  subtotal:
    pattern: "(?im)^\\s*(?:Subtotal|Sub\\s+Total)\\s*\\$?\\s*(\\d{1,3}(?:,\\d{3})*\\.\\d{2})"
    group: 1
    case_insensitive: true
  
  tax:
    pattern: "(?im)^\\s*(?:Tax|Sales\\s+Tax|Tax\\s+Amount)\\s*\\$?\\s*(\\d{1,3}(?:,\\d{3})*\\.\\d{2})"
    group: 1
    case_insensitive: true

# --- Validation Rules ---
validation:
  required_fields:
    - receipt_number
    # transaction_date is optional (can use invoice_date or order date)
    # total is optional (can be calculated from items)
  min_items: 0
  max_items: 1000

# --- Notes ---
notes:
  - "Generic Odoo Purchase Order format"
  - "Receipt format is flexible and may vary"
  - "Patterns are designed to be flexible and handle various receipt formats"
  - "OCR may be needed for image-based PDFs"
  - "UoM mapping: Units/Unit -> unit, LB/Lb/lb -> lb"
